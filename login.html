<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOH 2025 - Prihlásenie</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-top: 64px; /* Odsadenie pre pevnú hlavičku */
        }
        /* Štýly pre modálne okná */
        .modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 90%;
        }
    </style>
</head>
<body>
    <!-- Hlavička - bude načítaná dynamicky -->
    <div id="header-placeholder"></div>

    <!-- Hlavný obsah pre prihlasovaciu stránku -->
    <div id="root" class="flex items-center justify-center min-h-screen bg-gray-100">
        <!-- Tu bude obsah prihlasovacieho formulára, napr. z login-app.js -->
        <div class="w-full max-w-md p-4">
            <div class="bg-white p-8 rounded-lg shadow-xl w-full">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Prihlásenie</h1>
                <!-- Príklad obsahu, nahraďte skutočným formulárom -->
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="email" class="block text-gray-700 text-sm font-bold mb-2">E-mail</label>
                        <input type="email" id="email" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500" placeholder="Váš e-mail" required>
                    </div>
                    <div>
                        <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Heslo</label>
                        <input type="password" id="password" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500" placeholder="Vaše heslo" required>
                    </div>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Prihlásiť sa
                    </button>
                    <p class="text-center text-gray-600 text-sm mt-4">
                        Nemáte účet? <a href="register.html" class="text-blue-500 hover:text-blue-700 font-semibold">Registrovať sa</a>
                    </p>
                </form>
                <div id="login-error-message" class="text-red-500 text-center mt-4 hidden"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- React a ReactDOM (ak ich login.html používa, inak ich môžete odstrániť) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Globálne premenné pre Firebase config (pre React aplikácie a header) -->
    <script type="text/javascript">
        const __app_id = '1:26454452024:web:6954b4f90f87a3a1eb43cd';
        const __firebase_config = JSON.stringify({
            apiKey: "AIzaSyDj_bSTkjrquu1nyIVYW7YLbyBl1pD6YYo",
            authDomain: "prihlasovanie-4f3f3.firebaseapp.com",
            projectId: "prihlasovanie-4f3f3",
            storageBucket: "prihlasovanie-4f3f3.firebasestorage.app",
            messagingSenderId: "26454452024",
            appId: "1:26454452024:web:6954b4f90f87a3a1eb43cd"
        });
        const __initial_auth_token = null; // Pre login stránku môže byť null
        const __firebase_app_name = 'headerApp'; // Názov Firebase aplikácie pre hlavičku
    </script>

    <!-- Vlastné skripty -->
    <script src="header.js"></script> <!-- Načítať header.js -->
    <!-- Ak máte login.js alebo login-app.js, načítajte ho tu -->
    <!-- <script type="text/babel" src="login-app.js"></script> -->

    <script type="text/javascript">
        // Funkcia na načítanie hlavičky
        async function loadHeader() {
            try {
                const response = await fetch('header.html');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const headerHtml = await response.text();
                document.getElementById('header-placeholder').innerHTML = headerHtml;
            } catch (error) {
                console.error("Chyba pri načítaní hlavičky:", error);
                document.getElementById('header-placeholder').innerHTML = '<div style="color: red; text-align: center; padding: 10px;">Chyba pri načítaní hlavičky.</div>';
            }
        }

        // Spustí sa po načítaní DOM a všetkých skriptov
        window.onload = function() {
            loadHeader().then(() => {
                // Po načítaní hlavičky inicializovať jej logiku
                if (typeof initializeHeaderLogic === 'function') {
                    initializeHeaderLogic();
                } else {
                    console.warn("Funkcia initializeHeaderLogic nie je definovaná v header.js.");
                }

                // *** DÔLEŽITÉ: Inicializácia predvolenej Firebase aplikácie pre login.html ***
                try {
                    // Skontrolujeme, či už existuje predvolená aplikácia Firebase
                    if (firebase.apps.length === 0) {
                        firebase.initializeApp(JSON.parse(__firebase_config));
                        console.log("login.html: Predvolená Firebase aplikácia inicializovaná.");
                    } else {
                        console.log("login.html: Používa sa existujúca predvolená Firebase aplikácia.");
                    }
                } catch (e) {
                    console.error("login.html: Chyba pri inicializácii predvolenej Firebase aplikácie:", e);
                    // Zobraziť chybu používateľovi, ak inicializácia zlyhá
                    const errorMessageDiv = document.getElementById('login-error-message');
                    if (errorMessageDiv) {
                        errorMessageDiv.textContent = `Chyba pri načítaní aplikácie: ${e.message}`;
                        errorMessageDiv.classList.remove('hidden');
                    }
                    return; // Zastaviť ďalšie spracovanie, ak Firebase zlyhá
                }


                // Ak máte React aplikáciu pre login, renderujte ju tu
                // if (typeof LoginApp === 'function') {
                //     const root = ReactDOM.createRoot(document.getElementById('root'));
                //     root.render(React.createElement(LoginApp, null));
                // } else {
                //     console.warn("Komponent LoginApp nie je definovaný.");
                // }

                // Príklad základnej prihlasovacej logiky pre login.html (ak nepoužívate React pre formulár)
                const loginForm = document.getElementById('login-form');
                const emailInput = document.getElementById('email');
                const passwordInput = document.getElementById('password');
                const errorMessageDiv = document.getElementById('login-error-message');

                if (loginForm && firebase.auth) {
                    loginForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = emailInput.value;
                        const password = passwordInput.value;
                        errorMessageDiv.classList.add('hidden'); // Skryť predchádzajúce chyby

                        try {
                            const auth = firebase.auth(); // Použijeme predvolenú inštanciu
                            await auth.signInWithEmailAndPassword(email, password);
                            console.log("Prihlásenie úspešné, presmerovanie...");
                            window.location.href = 'logged-in-my-data.html'; // Presmerovanie po úspešnom prihlásení
                        } catch (error) {
                            console.error("Chyba pri prihlásení:", error);
                            let message = "Nastala neznáma chyba. Skúste to prosím znova.";
                            if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                                message = "Nepodarilo sa prihlásiť – nesprávne meno alebo heslo.";
                            } else if (error.code === 'auth/invalid-email') {
                                message = "Neplatný formát e-mailu.";
                            }
                            errorMessageDiv.textContent = message;
                            errorMessageDiv.classList.remove('hidden');
                        }
                    });
                } else {
                    console.warn("Prihlasovací formulár alebo Firebase Auth nie sú dostupné.");
                }

            }).catch(error => {
                console.error("Chyba pri inicializácii stránky:", error);
            });
        };
    </script>
</body>
</html>
